webpackJsonp([28],{"5okW":function(t,e,o){var l=o("8Q4x");"string"==typeof l&&(l=[[t.i,l,""]]),l.locals&&(t.exports=l.locals);o("rjj0")("0c35e9cb",l,!0)},"8Q4x":function(t,e,o){e=t.exports=o("FZ+f")(!1),e.push([t.i,"\n.see-goods-fy[data-v-0c7b1123] {\n  overflow: hidden;\n  margin-top: 10px;\n}\n.el-pagination[data-v-0c7b1123] {\n  float: right;\n}\n.del-sele-good[data-v-0c7b1123] {\n  width: 60px;\n  margin: 0;\n}\n.submit-box[data-v-0c7b1123] {\n  margin: 20px 0 40px;\n  padding-left: 240px;\n}\n.u-right[data-v-0c7b1123] {\n  margin-bottom: 15px;\n}\n.u-right .el-input[data-v-0c7b1123] {\n  width: 290px;\n}\n\n",""])},VJkT:function(t,e,o){"use strict";function l(t){o("5okW")}Object.defineProperty(e,"__esModule",{value:!0});var s=o("6Trz"),a=o("zVef"),i=o("js5j"),n={data:function(){return{hint:{title:"操作提示",content:"优惠促销管理, 由平台设置管理。"},tableData:[],status:"",search_str:"",multipleSelection:[],totalPage:1,add_show:!1,crumb:{from:"捆绑促销列表",now:"编辑活动"},ruleForm:{title:"",cost_price:0,status:"",desc:"",goods:[]},rules:{title:[{required:!0,message:"请输入活动名称",trigger:"blur"}],price:[{required:!0,message:"请输入促销价格"},{type:"number",message:"请填写数字"}],status:[{required:!0,type:"number",message:"请选择是否上架",trigger:"blur"}]},dialogVisible_goods:!1,choice_goods_data:[],choice_index:1,choice_pgCount:"",search_type:"",search_str_:"",str_products_id:"",multipleSelection_:[],id:"",del_id:[],loading:!0}},created:function(){this.get_seles()},methods:{go_back:function(){this.add_show=!1},to_page:function(){this.get_seles()},get_seles:function(){var t=this;this.axios.post(this.getApi("seller/auth/bundling_list"),this.dafa({index:this.index,name:this.search_str,status:this.status})).then(function(e){t.loading=!1,0===e.data.code?(t.tableData=e.data.list,t.totalPage=e.data.fy_pgCount):t.$message(e.data.msg)}).catch(function(){t.loading=!1,t.$message("对不起！请稍后再试")})},choice_goods:function(){var t=this;this.dialogVisible_goods=!0,this.str_products_id="",this.ruleForm.goods&&this.ruleForm.goods.forEach(function(e){t.str_products_id+=e.good_id+","}),this.get_seles_goods()},get_seles_goods:function(){var t=this;this.axios.post(this.getApi("seller/auth/bundling_goods"),this.dafa({goods_id:this.str_products_id,index:this.choice_index,search_type:this.search_type,search_str:this.search_str_})).then(function(e){0===e.data.code&&(t.choice_pgCount=e.data.fy_pgCount,t.choice_goods_data=e.data.list)}).catch(function(t){console.log(t)})},next_choice_goods:function(t){this.choice_index=t,this.get_seles_goods()},edit_seles:function(t){var e=this;this.id=t,this.antiShake.antiShake(function(o,l){e.axios.post(e.getApi("seller/auth/bundling_edit"),"id="+t).then(function(t){o(t),0===t.data.code&&(e.add_show=!0,t.data.info?e.ruleForm=t.data.info:e.ruleForm={title:"",cost_price:0,price:0,status:"",desc:"",goods:[]})}).catch(function(t){l(t),console.log(t)})})},del_seles_goods:function(t,e){this.ruleForm.goods.splice(t,1)},toggleSelection:function(t){var e=this;t?t.forEach(function(t){e.$refs.multipleTable.toggleRowSelection(t)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(t){this.multipleSelection=t},handleSelectionChange_:function(t){this.multipleSelection_=t},add_seles_goods:function(){var t=this;this.ruleForm.goods=this.multipleSelection_.concat(this.ruleForm.goods),this.ruleForm.goods.forEach(function(e){t.ruleForm.cost_price+=parseFloat(e.sell_price)}),this.dialogVisible_goods=!1},del_seles:function(t){var e=this;this.$confirm("是否确认将删除此活动?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){"all"===t?e.multipleSelection.forEach(function(t){e.del_id.push(t.id)}):e.del_id.push(t),e.antiShake.antiShake(function(t,o){e.axios.post(e.getApi("seller/auth/bundling_del"),e.dafa({id_list:e.del_id})).then(function(o){t(o),e.del_id=[],0===o.data.code?e.get_seles():e.toggleSelection()}).catch(function(t){o(t),console.log(t),e.toggleSelection(),e.del_id=[]})})}).catch(function(){e.toggleSelection(),e.del_id=[],e.$message({type:"info",message:"已取消删除"})})},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return e.$message("请检查填写信息是否有误"),!1;var o="";e.ruleForm.goods&&e.ruleForm.goods.forEach(function(t){o+=t.good_id+","}),e.antiShake.antiShake(function(t,l){e.axios.post(e.getApi("seller/auth/bundling_save"),e.dafa({id:e.id,title:e.ruleForm.title,status:e.ruleForm.status,price:e.ruleForm.price,desc:e.ruleForm.desc,goods_id:o})).then(function(o){t(o),0===o.data.code&&(e.add_show=!1,e.get_seles())}).catch(function(t){l(t)})})})}},computed:{index:function(){return this.$store.state.index}},components:{hint:s.a,crumb:a.a,page:i.a}},r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"member-list prop-box"},[o("div",{staticClass:"m-member-list m-prop-box"},[o("hint",{attrs:{title:t.hint.title,content:t.hint.content}}),t._v(" "),o("h2",[t._v("捆绑促销列表\n      "),o("el-button",{staticClass:"add-member-btn add-btn",attrs:{type:"text",icon:"plus",size:"small"},on:{click:function(e){t.edit_seles("")}}},[t._v("添加活动\n      ")]),t._v(" "),o("div",{staticClass:"u-right"},[o("el-select",{staticClass:"sele-s",attrs:{placeholder:"活动类型",clearable:!0},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[o("el-option",{attrs:{label:"下架",value:"0"}}),t._v(" "),o("el-option",{attrs:{label:"上架",value:"1"}})],1),t._v(" "),o("el-input",{staticClass:"search",attrs:{placeholder:"搜索活动名"},model:{value:t.search_str,callback:function(e){t.search_str=e},expression:"search_str"}},[o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.get_seles},slot:"append"})],1)],1)],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",attrs:{"element-loading-text":"拼命加载中",data:t.tableData,stripe:"",border:""},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),o("el-table-column",{attrs:{prop:"title",label:"活动名称","min-width":"160"}}),t._v(" "),o("el-table-column",{attrs:{prop:"price",label:"套餐价格","min-width":"160"}}),t._v(" "),o("el-table-column",{attrs:{prop:"status",label:"活动类型","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?o("span",[t._v("上架")]):o("span",[t._v("下架")])]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"操作","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"primary",size:"small",icon:"edit"},on:{click:function(o){t.edit_seles(e.row.id)}}},[t._v("编辑\n          ")]),t._v(" "),o("el-button",{attrs:{type:"danger",size:"small",icon:"delete"},on:{click:function(o){t.del_seles(e.row.id)}}},[t._v("删除\n          ")])]}}])})],1),t._v(" "),t.tableData.length>0?o("div",{staticClass:"select-all"},[o("el-button",{attrs:{plain:!0,type:"primary"},on:{click:function(e){t.toggleSelection()}}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{plain:!0,disabled:0==t.multipleSelection.length,type:"danger"},on:{click:function(e){t.del_seles("all")}}},[t._v("删除\n      ")])],1):t._e(),t._v(" "),o("page",{attrs:{totalPage:t.totalPage,currentPage:t.index},on:{toPage:t.to_page}})],1),t._v(" "),t.add_show?o("div",{staticClass:"add-member prop"},[o("crumb",{attrs:{from:t.crumb.from,now:t.crumb.now},on:{goBack:t.go_back}}),t._v(" "),o("el-tabs",{attrs:{type:"border-card"}},[o("el-tab-pane",{attrs:{label:"基本信息"}},[o("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"240px"}},[o("el-form-item",{attrs:{label:"促销名称",prop:"title"}},[o("el-input",{model:{value:t.ruleForm.title,callback:function(e){t.$set(t.ruleForm,"title",e)},expression:"ruleForm.title"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"捆绑销售价",prop:"price"}},[o("el-input",{model:{value:t.ruleForm.price,callback:function(e){t.$set(t.ruleForm,"price",t._n(e))},expression:"ruleForm.price"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"商品原价格",prop:"cost_price"}},[t._v("\n            "+t._s(t.ruleForm.cost_price)+"\n          ")]),t._v(" "),o("el-form-item",{attrs:{label:"是否上架",prop:"status"}},[o("el-select",{model:{value:t.ruleForm.status,callback:function(e){t.$set(t.ruleForm,"status",t._n(e))},expression:"ruleForm.status"}},[o("el-option",{attrs:{label:"下架",value:0}}),t._v(" "),o("el-option",{attrs:{label:"上架",value:1}})],1)],1),t._v(" "),o("el-form-item",{attrs:{label:"活动描述"}},[o("el-input",{attrs:{type:"textarea",rows:2},model:{value:t.ruleForm.desc,callback:function(e){t.$set(t.ruleForm,"desc",e)},expression:"ruleForm.desc"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"选择商品"}},[o("el-button",{on:{click:t.choice_goods}},[t._v("选择商品")])],1),t._v(" "),o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.ruleForm.goods,stripe:""}},[o("el-table-column",{attrs:{prop:"good_name",label:"商品名称","min-width":"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("a",{attrs:{href:e.row.good_link,target:"_blank"}},[t._v(t._s(e.row.good_name))])]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"sell_price",label:"价格","min-width":"140"}}),t._v(" "),o("el-table-column",{attrs:{prop:"store_nums",label:"库存","min-width":"100"}}),t._v(" "),o("el-table-column",{attrs:{label:"操作","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{staticClass:"del-sele-good",attrs:{type:"danger",size:"small"},on:{click:function(o){t.del_seles_goods(e.$index,t.tableData)}}},[t._v("\n                  删除\n                ")])]}}])})],1)],1)],1),t._v(" "),o("div",{staticClass:"submit-box"},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("确认提交")])],1)],1)],1):t._e(),t._v(" "),o("el-dialog",{attrs:{title:"选择商品",visible:t.dialogVisible_goods,width:"80%"},on:{"update:visible":function(e){t.dialogVisible_goods=e}}},[o("div",{staticClass:"u-right"},[o("el-select",{staticClass:"sele-s",attrs:{placeholder:"搜索类型",clearable:!0},model:{value:t.search_type,callback:function(e){t.search_type=e},expression:"search_type"}},[o("el-option",{attrs:{label:"商品编号",value:"0"}}),t._v(" "),o("el-option",{attrs:{label:"商品名称",value:"1"}})],1),t._v(" "),o("el-input",{staticClass:"search",attrs:{placeholder:"搜索关键词"},model:{value:t.search_str_,callback:function(e){t.search_str_=e},expression:"search_str_"}},[o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.get_seles_goods},slot:"append"})],1)],1),t._v(" "),o("el-table",{attrs:{data:t.choice_goods_data},on:{"selection-change":t.handleSelectionChange_}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),o("el-table-column",{attrs:{property:"good_name",label:"商品名称","min-width":"260"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("a",{attrs:{href:e.row.good_link,target:"_blank"}},[t._v(t._s(e.row.good_name))])]}}])}),t._v(" "),o("el-table-column",{attrs:{property:"sell_price",label:"价格","min-width":"100"}}),t._v(" "),o("el-table-column",{attrs:{property:"store_nums",label:"库存","min-width":"100"}})],1),t._v(" "),o("div",{staticClass:"see-goods-fy"},[o("el-pagination",{attrs:{"current-page":t.choice_index,layout:"total, prev, pager, next, jumper","page-count":t.choice_pgCount},on:{"current-change":t.next_choice_goods}})],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:t.add_seles_goods}},[t._v("添 加")])],1)],1)],1)},c=[],d={render:r,staticRenderFns:c},u=d,_=o("VU/8"),p=l,h=_(n,u,!1,p,"data-v-0c7b1123",null);e.default=h.exports}});